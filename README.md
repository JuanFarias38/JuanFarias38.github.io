<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema de Reservas - Happyland</title>
  <meta name="description" content="Página inicial de reservas para Bowling, Eventos de Empresas, Happy School y Happycards." />
  <style>
    :root{
      --bg:#0f172a;         /* slate-900 */
      --card:#111827;       /* gray-900 */
      --muted:#94a3b8;      /* slate-400 */
      --text:#e5e7eb;       /* gray-200 */
      --accent:#22c55e;     /* green-500 */
      --accent-2:#3b82f6;   /* blue-500 */
      --danger:#ef4444;     /* red-500 */
      --border:#1f2937;     /* gray-800 */
      --focus: 0 0 0 3px rgba(59,130,246,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,#0b1023,#0f172a);color:var(--text);}
    .wrap{max-width:980px;margin-inline:auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:24px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:12px;background:radial-gradient(120% 120% at 10% 10%, var(--accent), #16a34a 40%, #065f46 100%);box-shadow:0 8px 30px rgba(34,197,94,.25)}
    h1{font-size:clamp(20px,4vw,28px);margin:0}
    .sub{color:var(--muted);font-size:14px}

    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:linear-gradient(180deg,#0e1329,#0c1224);border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,.4)}
    .card h2{margin:0 0 12px 0;font-size:18px}
    .hint{color:var(--muted);font-size:13px;margin:6px 0 14px}

    form{display:grid;gap:18px}
    .row{display:grid;gap:12px}
    @media(min-width:620px){.row--2{grid-template-columns:1fr 1fr}}

    label{display:flex;gap:8px;align-items:center;font-weight:600;font-size:14px}
    input,select,button,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#0b1021;color:var(--text);font-size:15px;}
    input::placeholder,textarea::placeholder{color:#6b7280}
    textarea{min-height:90px;resize:vertical}
    select{appearance:none;background-image:linear-gradient(45deg,transparent 50%, var(--muted) 50%),linear-gradient(135deg, var(--muted) 50%,transparent 50%);background-position:calc(100% - 20px) calc(1em + 2px),calc(100% - 15px) calc(1em + 2px);background-size:5px 5px,5px 5px;background-repeat:no-repeat}
    input:focus,select:focus,textarea:focus,button:focus{outline:none;box-shadow:var(--focus)}

    .actions{display:flex;gap:12px;flex-wrap:wrap}
    .btn{cursor:pointer;font-weight:700;border:1px solid transparent;transition:.2s transform ease,.2s background-color ease}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#10b981);}
    .btn-secondary{background:#0b1021;border-color:#1f2937}
    .btn-outline{background:transparent;border-color:#334155}

    .required{color:#ef9a9a;font-weight:700}
    .error{color:var(--danger);font-size:13px;margin-top:6px}
    .ok{color:#34d399;font-size:13px;margin-top:6px}

    .preview{border:1px dashed #334155;border-radius:14px;padding:12px;background:#0b1021;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:13px;white-space:pre-wrap;word-break:break-word}

    footer{margin-top:24px;color:var(--muted);font-size:12px;text-align:center}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b1021;border:1px solid #1f2937}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Sistema de Reservas</h1>
          <div class="sub">Versión inicial • Listo para subir a GitHub Pages</div>
        </div>
      </div>
      <div class="badge">Alpha</div>
    </header>

    <main class="grid" id="app">
      <!-- Datos de contacto -->
      <section class="card" aria-labelledby="hdr-contacto">
        <h2 id="hdr-contacto">1) Datos de contacto</h2>
        <p class="hint">Completa la información del solicitante. Los campos con <span class="required">*</span> son obligatorios.</p>

        <form id="form-contacto" novalidate>
          <div class="row row--2">
            <div>
              <label for="nombre">Nombre <span class="required">*</span></label>
              <input id="nombre" name="nombre" type="text" placeholder="Juan" autocomplete="given-name" required />
              <div class="error" data-error-for="nombre"></div>
            </div>
            <div>
              <label for="apellido">Apellido <span class="required">*</span></label>
              <input id="apellido" name="apellido" type="text" placeholder="Pérez" autocomplete="family-name" required />
              <div class="error" data-error-for="apellido"></div>
            </div>
          </div>

          <div class="row row--2">
            <div>
              <label for="empresa">Nombre empresa <span class="required">*</span></label>
              <input id="empresa" name="empresa" type="text" placeholder="Happyland Empresas" required />
              <div class="error" data-error-for="empresa"></div>
            </div>
            <div>
              <label for="rut">RUT empresa <span class="required">*</span></label>
              <input id="rut" name="rut" type="text" placeholder="76.543.210-9" inputmode="text" autocomplete="off" required />
              <div class="error" data-error-for="rut"></div>
            </div>
          </div>

          <div class="row row--2">
            <div>
              <label for="telefono">Teléfono <span class="required">*</span></label>
              <input id="telefono" name="telefono" type="tel" placeholder="+56 9 1234 5678" required />
              <div class="error" data-error-for="telefono"></div>
            </div>
            <div>
              <label for="correo">Correo <span class="required">*</span></label>
              <input id="correo" name="correo" type="email" placeholder="juan.perez@empresa.cl" autocomplete="email" required />
              <div class="error" data-error-for="correo"></div>
            </div>
          </div>

          <div class="actions">
            <button type="button" class="btn btn-secondary" id="btn-guardar-contacto">Guardar datos</button>
          </div>
          <div id="estado-contacto" role="status" aria-live="polite" class="ok" style="display:none"></div>
        </form>
      </section>

      <!-- Reserva -->
      <section class="card" aria-labelledby="hdr-reserva">
        <h2 id="hdr-reserva">2) Detalles de la reserva</h2>
        <p class="hint">Selecciona el tipo de reserva, la fecha y la hora deseadas.</p>

        <form id="form-reserva" novalidate>
          <div class="row">
            <div>
              <label for="tipo">Tipo de reserva <span class="required">*</span></label>
              <select id="tipo" name="tipo" required>
                <option value="" disabled selected>Selecciona una opción</option>
                <option>Bowling</option>
                <option>Evento Empresas</option>
                <option>Happy School</option>
                <option>Happycards</option>
              </select>
              <div class="error" data-error-for="tipo"></div>
            </div>
          </div>

          <div class="row row--2">
            <div>
              <label for="fecha">Fecha <span class="required">*</span></label>
              <input id="fecha" name="fecha" type="date" required />
              <div class="error" data-error-for="fecha"></div>
            </div>
            <div>
              <label for="hora">Hora <span class="required">*</span></label>
              <input id="hora" name="hora" type="time" required />
              <div class="error" data-error-for="hora"></div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="comentarios">Comentarios (opcional)</label>
              <textarea id="comentarios" name="comentarios" placeholder="Detalles adicionales, # de asistentes, requerimientos, etc."></textarea>
            </div>
          </div>

          <div class="actions">
            <button type="submit" class="btn btn-primary">Reservar</button>
            <button type="button" class="btn btn-outline" id="btn-limpiar">Limpiar</button>
          </div>

          <div id="estado-reserva" role="status" aria-live="polite" class="ok" style="display:none"></div>
        </form>

        <div class="hint" style="margin-top:10px">Previsualización (no se envía aún):</div>
        <div id="preview" class="preview" aria-live="polite">Completa los formularios para ver el resumen…</div>
      </section>
    </main>

    <footer>
      <p>© <span id="anio"></span> Happyland • Prototipo UI. Sin backend aún.</p>
    </footer>
  </div>

  <script>
    // Utilidad: formatear y validar RUT chileno
    function limpiarRut(rut){
      return (rut || "").toString().replace(/\./g,"").replace(/-/g,"").toUpperCase();
    }
    function dvRut(numero){
      let M=0,S=1;for(;numero;numero=Math.floor(numero/10))S=(S+numero%10*(9-M++%6))%11;return S?S-1:'K';
    }
    function validarRut(rutStr){
      const limpio = limpiarRut(rutStr);
      if(!/^\d{7,8}[0-9K]$/.test(limpio)) return false;
      const cuerpo = limpio.slice(0,-1);
      const dv = limpio.slice(-1);
      return dvRut(parseInt(cuerpo,10)).toString() === dv;
    }
    function formatearRut(rutStr){
      const limpio = limpiarRut(rutStr);
      if(limpio.length < 2) return rutStr;
      const cuerpo = limpio.slice(0,-1);
      const dv = limpio.slice(-1);
      const conPuntos = cuerpo.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      return `${conPuntos}-${dv}`;
    }

    // Estado global mínimo
    const state = {
      contacto: {},
      reserva: {},
    };

    const formContacto = document.getElementById('form-contacto');
    const formReserva  = document.getElementById('form-reserva');
    const preview = document.getElementById('preview');
    const estadoContacto = document.getElementById('estado-contacto');
    const estadoReserva = document.getElementById('estado-reserva');

    // Helper para mostrar errores
    function setError(inputId, msg){
      const el = document.querySelector(`[data-error-for="${inputId}"]`);
      if(el){ el.textContent = msg || ''; }
    }

    // Validación de contacto
    function validarContacto(){
      let ok = true;
      const nombre = document.getElementById('nombre');
      const apellido = document.getElementById('apellido');
      const empresa = document.getElementById('empresa');
      const rut = document.getElementById('rut');
      const telefono = document.getElementById('telefono');
      const correo = document.getElementById('correo');

      setError('nombre',''); setError('apellido',''); setError('empresa',''); setError('rut',''); setError('telefono',''); setError('correo','');

      if(!nombre.value.trim()){ setError('nombre','Ingresa el nombre'); ok=false; }
      if(!apellido.value.trim()){ setError('apellido','Ingresa el apellido'); ok=false; }
      if(!empresa.value.trim()){ setError('empresa','Ingresa la empresa'); ok=false; }

      const rutVal = rut.value.trim();
      if(!rutVal){ setError('rut','Ingresa el RUT'); ok=false; }
      else if(!validarRut(rutVal)){ setError('rut','RUT no válido'); ok=false; }
      else { rut.value = formatearRut(rutVal); }

      if(!telefono.value.trim()){ setError('telefono','Ingresa el teléfono'); ok=false; }
      if(!correo.value.trim()){ setError('correo','Ingresa el correo'); ok=false; }
      else if(!correo.checkValidity()){ setError('correo','Correo no válido'); ok=false; }

      if(ok){
        state.contacto = {
          nombre: nombre.value.trim(),
          apellido: apellido.value.trim(),
          empresa: empresa.value.trim(),
          rut: rut.value.trim(),
          telefono: telefono.value.trim(),
          correo: correo.value.trim()
        };
      }
      return ok;
    }

    // Validación de reserva
    function validarReserva(){
      let ok = true;
      const tipo = document.getElementById('tipo');
      const fecha = document.getElementById('fecha');
      const hora = document.getElementById('hora');

      setError('tipo',''); setError('fecha',''); setError('hora','');

      if(!tipo.value) { setError('tipo','Selecciona un tipo'); ok=false; }
      if(!fecha.value) { setError('fecha','Selecciona una fecha'); ok=false; }
      if(!hora.value) { setError('hora','Selecciona una hora'); ok=false; }

      if(ok){
        state.reserva = {
          tipo: tipo.value,
          fecha: fecha.value,
          hora: hora.value,
          comentarios: document.getElementById('comentarios').value.trim()
        };
      }
      return ok;
    }

    function actualizarPreview(){
      const data = { ...state.contacto, ...state.reserva };
      const hayDatos = Object.keys(data).length > 0;
      preview.textContent = hayDatos ? JSON.stringify(data, null, 2) : 'Completa los formularios para ver el resumen…';
    }

    document.getElementById('btn-guardar-contacto').addEventListener('click', ()=>{
      if(validarContacto()){
        estadoContacto.textContent = 'Datos de contacto guardados localmente.';
        estadoContacto.style.display = 'block';
        actualizarPreview();
      }
    });

    formReserva.addEventListener('submit', (e)=>{
      e.preventDefault();
      const contactoOk = Object.keys(state.contacto).length > 0 || validarContacto();
      const reservaOk = validarReserva();
      if(contactoOk && reservaOk){
        const payload = { ...state.contacto, ...state.reserva };
        actualizarPreview();
        // Aquí iría el envío a tu backend / Google Apps Script / Make / Zapier, etc.
        console.log('Reserva lista para enviar', payload);
        estadoReserva.textContent = '¡Reserva preparada! (de momento sólo previsualización)';
        estadoReserva.style.display = 'block';
      }
    });

    document.getElementById('btn-limpiar').addEventListener('click', ()=>{
      formContacto.reset();
      formReserva.reset();
      state.contacto = {}; state.reserva = {};
      document.querySelectorAll('.error').forEach(e=> e.textContent='');
      estadoContacto.style.display = 'none';
      estadoReserva.style.display = 'none';
      actualizarPreview();
      // reset min fecha nuevamente
      setMinFechaHoy();
    });

    // Restringir la fecha mínima a hoy
    function setMinFechaHoy(){
      const hoy = new Date();
      const yyyy = hoy.getFullYear();
      const mm = String(hoy.getMonth()+1).padStart(2,'0');
      const dd = String(hoy.getDate()).padStart(2,'0');
      document.getElementById('fecha').setAttribute('min', `${yyyy}-${mm}-${dd}`);
    }

    // Formatear RUT al salir del campo
    document.getElementById('rut').addEventListener('blur', (e)=>{
      const v = e.target.value.trim();
      if(v){ e.target.value = formatearRut(v); }
    });

    // Inicialización
    document.getElementById('anio').textContent = new Date().getFullYear();
    setMinFechaHoy();
    actualizarPreview();
  </script>
</body>
</html>
